# SAYJONG 콘텐츠 생성 파이프라인 (Content Creation Pipeline)

## 📌 1. 이 서버는 무엇인가요?

이 프로젝트는 **SAYJONG (세종) 서비스의 학습 콘텐츠 생성을 전담하는 별도의 워커(Worker) 서버**입니다.

사용자가 새로운 K-POP 노래 학습을 요청했을 때, 해당 노래의 가사, 발음, 번역, 원어민 음성 등 학습에 필요한 모든 데이터를 자동으로 가공하고 생성하는 역할을 수행합니다.

이 서버는 메인 Spring 서버로부터 내부 API(HTTP) 호출을 통해 작업 요청을 받아 처리하는 백그라운드 워커 서버입니다.

## 🤔 2. 왜 별도의 서버가 필요한가요?

가장 결정적인 이유는 **es-hangul**과 같이 Node.js 환경에서만 실행 가능한 핵심 라이브러리를 사용해야 하기 때문입니다.

또한, 학습 콘텐츠를 생성하는 과정은 여러 외부 API(Spotify, DeepL 등)를 순차적으로 호출하고 데이터를 가공해야 하는, 시간이 오래 걸리고 I/O(입출력)가 빈번한 작업입니다. 이러한 작업을 메인 API 서버(Spring)가 직접 처리하게 되면 다음과 같은 문제가 발생할 수 있습니다.

* **성능 저하**: 무거운 콘텐츠 생성 작업이 메인 서버의 리소스를 점유하여, 로그인, 발음 연습 등 다른 사용자들의 핵심 기능 사용에 대한 응답 속도를 느리게 만듭니다.
* **서비스 불안정**: 외부 API(Spotify, DeepL 등) 중 하나라도 응답이 지연되거나 오류가 발생하면, 그 영향이 메인 서버 전체로 퍼져 서비스가 멈출 수 있습니다.

이러한 문제들을 해결하기 위해, 콘텐츠 생성이라는 무겁고 독립적인 작업을 NestJS(Node.js) 기반의 워커 서버로 분리했습니다. 이를 통해 다음과 같은 이점을 얻을 수 있습니다.

1.  핵심 제약 조건 해결: Node.js 전용 라이브러리(es-hangul)를 문제없이 사용할 수 있습니다.
2.  안정성 확보 (Decoupling): 본 워커 서버에 장애가 발생하더라도(e.g., ElevenLabs API 오류), 메인 Spring 서비스는 전혀 영향을 받지 않고 안정적으로 운영됩니다.
3.  최적의 성능 유지 (Performance): 메인 Spring 서버는 가벼운 핵심 기능에만 집중하고, 시간 소모가 큰 I/O 작업은 NestJS 서버가 전담하여 모든 사용자에게 쾌적한 경험을 제공합니다.

## 🛠️ 3. 어떻게 동작하나요?

비동기 HTTP 통신 방식을 사용합니다.

1.  요청 접수: 사용자가 메인 Spring 서버에 새 노래 학습을 요청합니다. Spring 서버는 DB에 해당 작업의 status를 PENDING (처리 중)으로 저장합니다.
2. 즉시 응답: Spring 서버는 사용자에게 즉시 "요청이 정상적으로 접수되었습니다" 라는 응답(e.g., 202 Accepted)을 보냅니다. (사용자는 긴 로딩을 기다릴 필요가 없습니다.)
3. 작업 위임: Spring 서버는 백그라운드에서(@Async 등) NestJS 워커 서버(본 프로젝트)의 내부 API 엔드포인트를 호출하여 작업을 위임합니다.
4. 콘텐츠 생성: NestJS 워커 서버는 요청을 받아 아래의 파이프라인을 순차적으로 실행합니다.
    * **Spotify API**: 가사 및 싱크 타이밍 정보 추출
    * **es-hangul 라이브러리**: 한글 가사를 로마자 발음 표기로 변환
    * **DeepL API**: 가사를 영어로 번역
    * **ElevenLabs API**: 원어민 발음(TTS) 음성 파일 생성 후 클라우드 스토리지에 업로드 및 URL 반환
5. 결과 전송 / 콜백: 모든 데이터 생성이 완료되면, NestJS 워커는 Spring 서버의 내부 '완료' 엔드포인트로 완성된 데이터 전체를 POST 요청으로 전송합니다.
6. 저장: Spring 서버는 이 콜백 요청을 받아 데이터를 검증한 후, DB에 저장하고 작업 status를 COMPLETED로 업데이트합니다. (실패 시 FAILED로 업데이트)

<img width="627" height="401" alt="image" src="https://github.com/user-attachments/assets/6040f77b-a4c1-428d-a664-6eaa73295400" />

